source 'https://github.com/CocoaPods/Specs.git'

platform :ios, '8.1'

inhibit_all_warnings!
use_frameworks!

target :victorious do
    pod 'MBProgressHUD'
    pod 'KVOController'
    pod 'SDWebImage'
    pod 'CCHLinkTextView'
    pod 'OAStackView'
    pod 'FBSDKCoreKit'
    pod 'FBSDKLoginKit'
    pod 'FBSDKShareKit'

    pod 'FLAnimatedImage', '~> 1.0'

    link_with 'victorious'

    target :test do
        pod 'Nocilla', :git => 'https://github.com/TouchFrame/Nocilla.git'
        pod 'OCMock'
        link_with 'victoriousTests', 'VictoriousCommonTests'
    end
end

target :VictoriousIOSSDKTests do
    pod 'Nocilla', :git => 'https://github.com/TouchFrame/Nocilla.git'
    link_with 'VictoriousIOSSDKTests'
end

target :victoriousPersistenceTests do
    pod 'Nocilla', :git => 'https://github.com/TouchFrame/Nocilla.git'
    link_with 'victoriousPersistenceTests'
end

post_install do |installer|
    installer.pods_project.targets.each do |target|
        target.build_configurations.each do |config|
            config.build_settings['ENABLE_BITCODE'] = 'NO'
            if config.name == "QA" || config.name == "Staging" || config.name == "Stable" then
                config.build_settings['CODE_SIGN_IDENTITY[sdk=iphoneos*]'] = 'iPhone Distribution'
            end
        end
    end

    installer.aggregate_targets.each do |target|
        # Without this hack resources from module tests won't make it to the unit test bundle
        # See https://github.com/CocoaPods/CocoaPods/issues/4752
        if target.name == "Pods-victorious-test" || target.name == "Pods-VictoriousIOSSDKTests" || target.name == "Pods-victoriousPersistenceTests" then
            %x~ sed -i '' 's/CONFIGURATION_BUILD_DIR/TARGET_BUILD_DIR/g' '#{target.support_files_dir}/#{target.name}-frameworks.sh' ~
            %x~ sed -i '' 's/CONFIGURATION_BUILD_DIR/TARGET_BUILD_DIR/g' '#{target.support_files_dir}/#{target.name}-resources.sh' ~
        end
    end
end
